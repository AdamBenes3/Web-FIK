<!DOCTYPE html>
<html>
<head>
    <title>Show Device Information</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Show Device Information</h1>
    <div id="buttons"></div>
    <div id="tableContainer"></div>

    <script>
        // Array to store JSON data
        var jsonDataArray = [
            {
                "topic": "v3/balloons@ttn/devices/fik8b/up",
                "message": "{\"end_device_ids\":{\"device_id\":\"fik8b\",\"application_ids\":{\"application_id\":\"balloons\"},\"dev_eui\":\"3C56A000A0000064\",\"dev_addr\":\"26011828\"},\"correlation_ids\":[\"gs:uplink:01HC2S1KTHVCEH508RK8V4QR98\"],\"received_at\":\"2023-10-06T15:17:38.464099702Z\",\"uplink_message\":{\"f_port\":1,\"f_cnt\":12247,\"frm_payload\":\"DwyHcTADnYMEAAIA9gi/AAE=\",\"decoded_payload\":{\"alt_m\":246,\"alt_okay\":1,\"course\":34.984375,\"course_okay\":1,\"lat\":50.11628341674805,\"latlon_age_s\":2,\"latlon_okay\":1,\"lon\":14.461121559143066,\"speed_mps\":0.0625,\"speed_okay\":0},\"rx_metadata\":[{\"gateway_ids\":{\"gateway_id\":\"crreat3\",\"eui\":\"58A0CBFFFE802F94\"},\"time\":\"2023-10-06T15:17:38.182800054Z\",\"timestamp\":1863533116,\"rssi\":-53,\"channel_rssi\":-53,\"snr\":11.25,\"location\":{\"latitude\":50.1163816927179,\"longitude\":14.4611111283302,\"altitude\":259,\"source\":\"SOURCE_REGISTRY\"},\"uplink_token\":\"ChUKEwoHY3JyZWF0MxIIWKDL//6AL5QQvITN+AYaCwiSyoCpBhCv+PF6IOD06pmeswE=\",\"received_at\":\"2023-10-06T15:17:38.184495382Z\"}],\"settings\":{\"data_rate\":{\"lora\":{\"bandwidth\":125000,\"spreading_factor\":10,\"coding_rate\":\"4/5\"}},\"frequency\":\"868100000\",\"timestamp\":1863533116,\"time\":\"2023-10-06T15:17:38.182800054Z\"},\"received_at\":\"2023-10-06T15:17:38.258632057Z\",\"consumed_airtime\":\"0.452608s\",\"locations\":{\"frm-payload\":{\"latitude\":50.11628341674805,\"longitude\":14.461121559143066,\"source\":\"SOURCE_GPS\"}},\"network_ids\":{\"net_id\":\"000013\",\"tenant_id\":\"ttn\",\"cluster_id\":\"eu1\",\"cluster_address\":\"eu1.cloud.thethings.network\"}}}",
                "timestamp": "2023-10-06T15:17:39.483Z"
            },
            {
                "topic": "v3/balloons@ttn/devices/fik8a/up",
                "message": "{\"end_device_ids\":{\"device_id\":\"fik8a\",\"application_ids\":{\"application_id\":\"balloons\"},\"dev_eui\":\"3C56A000A0000064\",\"dev_addr\":\"26011828\"},\"correlation_ids\":[\"gs:uplink:01HC2S1KTHVCEH508RK8V4QR98\"],\"received_at\":\"2023-10-06T15:17:38.464099702Z\",\"uplink_message\":{\"f_port\":1,\"f_cnt\":12247,\"frm_payload\":\"DwyHcTADnYMEAAIA9gi/AAE=\",\"decoded_payload\":{\"alt_m\":246,\"alt_okay\":1,\"course\":34.984375,\"course_okay\":1,\"lat\":50.11628341674805,\"latlon_age_s\":2,\"latlon_okay\":1,\"lon\":14.461121559143066,\"speed_mps\":0.0625,\"speed_okay\":0},\"rx_metadata\":[{\"gateway_ids\":{\"gateway_id\":\"crreat3\",\"eui\":\"58A0CBFFFE802F94\"},\"time\":\"2023-10-06T15:17:38.182800054Z\",\"timestamp\":1863533116,\"rssi\":-53,\"channel_rssi\":-53,\"snr\":11.25,\"location\":{\"latitude\":50.1163816927179,\"longitude\":14.4611111283302,\"altitude\":259,\"source\":\"SOURCE_REGISTRY\"},\"uplink_token\":\"ChUKEwoHY3JyZWF0MxIIWKDL//6AL5QQvITN+AYaCwiSyoCpBhCv+PF6IOD06pmeswE=\",\"received_at\":\"2023-10-06T15:17:38.184495382Z\"}],\"settings\":{\"data_rate\":{\"lora\":{\"bandwidth\":125000,\"spreading_factor\":10,\"coding_rate\":\"4/5\"}},\"frequency\":\"868100000\",\"timestamp\":1863533116,\"time\":\"2023-10-06T15:17:38.182800054Z\"},\"received_at\":\"2023-10-06T15:17:38.258632057Z\",\"consumed_airtime\":\"0.452608s\",\"locations\":{\"frm-payload\":{\"latitude\":50.11628341674805,\"longitude\":14.461121559143066,\"source\":\"SOURCE_GPS\"}},\"network_ids\":{\"net_id\":\"000013\",\"tenant_id\":\"ttn\",\"cluster_id\":\"eu1\",\"cluster_address\":\"eu1.cloud.thethings.network\"}}}",
                "timestamp": "2023-10-06T15:17:39.483Z"
            }
            // Add more JSON objects here as needed
        ];

        // Function to create or update a table for a device
        function createOrUpdateTable(jsonData) {
            // Parse the JSON data
            var jsonDataObj = JSON.parse(jsonData.message);

            // Extract device information
            var deviceId = jsonDataObj.end_device_ids.device_id;

            // Check if a table with the same device_id already exists
            var existingTable = document.getElementById(deviceId + 'Table');

            // Create a table if it doesn't exist
            if (!existingTable) {
                var table = document.createElement('table');
                table.id = deviceId + 'Table';
                table.innerHTML += `
                    <tr>
                        <th>Device ID</th>
                        <td>${deviceId}</td>
                    </tr>
                    <tr>
                        <th>Dev EUI</th>
                        <td>${jsonDataObj.end_device_ids.dev_eui}</td>
                    </tr>
                    <tr>
                        <th>Dev Addr</th>
                        <td>${jsonDataObj.end_device_ids.dev_addr}</td>
                    </tr>
                    <!-- Add more rows for other data -->
                `;

                // Add the table to the tableContainer
                var tableContainer = document.getElementById('tableContainer');
                tableContainer.appendChild(table);
            } else {
                // Toggle the visibility of the existing table
                var tableStyle = existingTable.style;
                tableStyle.display = tableStyle.display === 'none' ? 'table' : 'none';
            }
        }

        // Create buttons and handle button click events
        for (var i = 0; i < jsonDataArray.length; i++) {
            var jsonData = jsonDataArray[i];
            var deviceId = JSON.parse(jsonData.message).end_device_ids.device_id;

            // Check if a button with the same device_id already exists
            var existingButton = document.getElementById(deviceId + 'Button');

            // Create a button if it doesn't exist
            if (!existingButton) {
                // Create a button for each device
                var button = document.createElement('button');
                button.id = deviceId + 'Button'; // Assign an ID to the button
                button.textContent = deviceId;
                button.addEventListener('click', function(event) {
                    createOrUpdateTable(jsonDataArray.find(data => JSON.parse(data.message).end_device_ids.device_id === event.target.textContent));
                });

                // Add the button to the page
                var buttonsContainer = document.getElementById('buttons');
                buttonsContainer.appendChild(button);
            }
        }
    </script>
</body>
</html>
